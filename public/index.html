<!DOCTYPE html>
<html lang="sw">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sila AI - Msaidizi Wako Wa Kisasa</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* [All CSS styles remain exactly the same as previous WhatsApp design] */
        /* ... Previous CSS code remains unchanged ... */
        
        /* Add these new styles for audio player */
        .audio-player {
            width: 100%;
            margin-top: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 10px;
        }
        
        .audio-player audio {
            width: 100%;
            border-radius: 10px;
        }
        
        .voice-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #34C759;
            font-size: 14px;
            margin-top: 5px;
        }
        
        .pulse-animation {
            animation: pulse 1.5s infinite;
        }
    </style>
</head>
<body>
    <!-- [All HTML structure remains the same until the script section] -->
    
    <script>
        // Configuration
        const API_URL = window.location.origin;
        let currentSessionId = generateSessionId();
        let isImageMode = false;
        let isVoiceMode = false;
        let isRecording = false;
        let currentUser = null;
        let authToken = null;
        let currentLanguage = 'sw';
        let isMenuOpen = false;
        let isDarkMode = true;

        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            checkAuthStatus();
            setupEventListeners();
            loadTheme();
            loadLanguage();
            checkServerHealth();
        });

        // Setup event listeners
        function setupEventListeners() {
            const textarea = document.getElementById('messageInput');
            textarea.addEventListener('input', autoResizeTextarea);
            
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    const lang = this.dataset.lang;
                    updateAuthLanguage(lang);
                });
            });
            
            document.getElementById('loginForm')?.addEventListener('submit', handleLogin);
            document.getElementById('registerForm')?.addEventListener('submit', handleRegister);
            document.getElementById('forgotPasswordForm')?.addEventListener('submit', handleForgotPassword);
        }

        // Notification System
        function showNotification(message, type = 'info', duration = 5000) {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <div class="notification-title">${type.charAt(0).toUpperCase() + type.slice(1)}</div>
                    <div class="notification-message">${message}</div>
                </div>
                <button class="notification-close" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            container.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, duration);
        }

        // Loading overlay
        function showLoading() {
            document.getElementById('loadingOverlay').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }

        // Language functions
        function changeLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('sila_language', lang);
            document.getElementById('currentLanguage').textContent = lang.toUpperCase();
            updateUIForLanguage();
            
            showNotification(
                lang === 'sw' ? 'Lugha imebadilishwa kuwa Kiswahili' : 'Language changed to English',
                'success'
            );
        }

        function toggleLanguageDropdown() {
            const newLang = currentLanguage === 'sw' ? 'en' : 'sw';
            changeLanguage(newLang);
        }

        function updateUIForLanguage() {
            const translations = {
                sw: {
                    newChat: 'Mazungumzo Mapya',
                    history: 'Historia ya Mazungumzo',
                    upload: 'Pakia Faili',
                    contact: 'Wasiliana na Developer',
                    settings: 'Mipangilio',
                    logout: 'Toka',
                    placeholder: 'Andika ujumbe wako hapa...',
                    imagePlaceholder: 'Andika maelezo ya picha...',
                    voicePlaceholder: 'Andika maandishi ya kubadilisha kuwa sauti...',
                    welcomeTitle: 'Karibu kwenye Sila AI 2026',
                    welcomeText: 'Mimi ni Sila AI, msaidizi wako wa kisasa wa 2026. Nina uwezo wa kukumbuka mazungumzo, kutengeneza picha, kutengeneza sauti, kusoma faili, na kukusaidia katika kila jambo. Tuongee!',
                    welcomeLearn: 'Jijulishe',
                    welcomeSuggest: 'Pendekeza',
                    welcomeImage: 'Tengeneza Picha',
                    welcomeVoice: 'Tengeneza Sauti',
                    chatStatus: 'Inatumika',
                    historyTitle: 'Historia ya Mazungumzo'
                },
                en: {
                    newChat: 'New Chat',
                    history: 'Chat History',
                    upload: 'Upload File',
                    contact: 'Contact Developer',
                    settings: 'Settings',
                    logout: 'Logout',
                    placeholder: 'Type your message here...',
                    imagePlaceholder: 'Describe the image...',
                    voicePlaceholder: 'Type text to convert to voice...',
                    welcomeTitle: 'Welcome to Sila AI 2026',
                    welcomeText: 'I am Sila AI, your modern 2026 assistant. I can remember conversations, generate images, generate voice, read files, and help you with everything. Let\'s talk!',
                    welcomeLearn: 'Learn About',
                    welcomeSuggest: 'Suggest',
                    welcomeImage: 'Create Image',
                    welcomeVoice: 'Create Voice',
                    chatStatus: 'Online',
                    historyTitle: 'Chat History'
                }
            };
            
            const trans = translations[currentLanguage] || translations.sw;
            
            document.getElementById('menuNewChat').textContent = trans.newChat;
            document.getElementById('menuHistory').textContent = trans.history;
            document.getElementById('menuUpload').textContent = trans.upload;
            document.getElementById('menuContact').textContent = trans.contact;
            document.getElementById('menuSettings').textContent = trans.settings;
            document.getElementById('menuLogout').textContent = trans.logout;
            
            const input = document.getElementById('messageInput');
            if (isImageMode) {
                input.placeholder = trans.imagePlaceholder;
            } else if (isVoiceMode) {
                input.placeholder = trans.voicePlaceholder;
            } else {
                input.placeholder = trans.placeholder;
            }
            
            document.getElementById('welcomeTitle').textContent = trans.welcomeTitle;
            document.getElementById('welcomeText').textContent = trans.welcomeText;
            document.getElementById('welcomeLearn').textContent = trans.welcomeLearn;
            document.getElementById('welcomeSuggest').textContent = trans.welcomeSuggest;
            document.getElementById('welcomeImage').textContent = trans.welcomeImage;
            
            const welcomeImageBtn = document.querySelector('.welcome-actions button:nth-child(3)');
            if (welcomeImageBtn) {
                welcomeImageBtn.innerHTML = `<i class="fas fa-image"></i> ${trans.welcomeImage}`;
            }
            
            // Add voice button if not exists
            const welcomeActions = document.querySelector('.welcome-actions');
            if (welcomeActions && !document.getElementById('welcomeVoiceBtn')) {
                const voiceBtn = document.createElement('button');
                voiceBtn.className = 'welcome-btn';
                voiceBtn.id = 'welcomeVoiceBtn';
                voiceBtn.innerHTML = `<i class="fas fa-volume-up"></i> ${trans.welcomeVoice}`;
                voiceBtn.onclick = () => toggleVoiceMode();
                welcomeActions.appendChild(voiceBtn);
            }
            
            document.getElementById('chatStatus').textContent = trans.chatStatus;
            document.getElementById('historyTitle').textContent = trans.historyTitle;
        }

        function updateAuthLanguage(lang) {
            currentLanguage = lang;
            const translations = {
                sw: {
                    loginEmailLabel: 'Barua Pepe',
                    loginPasswordLabel: 'Nenosiri',
                    loginButton: 'Ingia',
                    registerLink: 'Jisajiri',
                    forgotLink: 'Umesahau nenosiri?',
                    registerUsernameLabel: 'Jina la Mtumiaji',
                    registerEmailLabel: 'Barua Pepe',
                    registerPasswordLabel: 'Nenosiri',
                    registerConfirmLabel: 'Thibitisha Nenosiri',
                    registerLanguageLabel: 'Chagua Lugha',
                    registerButton: 'Jisajiri',
                    loginLink: 'Tayari una akaunti? Ingia',
                    forgotEmailLabel: 'Barua Pepe Yako',
                    forgotButton: 'Tuma Maelekezo',
                    backToLoginLink: 'Rudi kwenye kuingia'
                },
                en: {
                    loginEmailLabel: 'Email',
                    loginPasswordLabel: 'Password',
                    loginButton: 'Login',
                    registerLink: 'Register',
                    forgotLink: 'Forgot Password?',
                    registerUsernameLabel: 'Username',
                    registerEmailLabel: 'Email',
                    registerPasswordLabel: 'Password',
                    registerConfirmLabel: 'Confirm Password',
                    registerLanguageLabel: 'Choose Language',
                    registerButton: 'Register',
                    loginLink: 'Already have an account? Login',
                    forgotEmailLabel: 'Your Email',
                    forgotButton: 'Send Instructions',
                    backToLoginLink: 'Back to Login'
                }
            };
            
            const trans = translations[lang] || translations.sw;
            
            Object.keys(trans).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    element.textContent = trans[key];
                }
            });
        }

        // Authentication functions
        async function checkAuthStatus() {
            const token = localStorage.getItem('sila_token');
            const user = localStorage.getItem('sila_user');
            
            if (token && user) {
                try {
                    const response = await fetch(`${API_URL}/api/health`);
                    
                    if (response.ok) {
                        authToken = token;
                        currentUser = JSON.parse(user);
                        currentLanguage = currentUser.language || 'sw';
                        showChatPage();
                    } else {
                        localStorage.removeItem('sila_token');
                        localStorage.removeItem('sila_user');
                        showAuthPage();
                    }
                } catch (error) {
                    showNotification('Hitilafu ya mtandao. Tafadhali angalia muunganisho wako.', 'error');
                    showAuthPage();
                }
            } else {
                showAuthPage();
            }
        }

        async function handleLogin(e) {
            e.preventDefault();
            showLoading();
            
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            try {
                const response = await fetch(`${API_URL}/api/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    authToken = data.token;
                    currentUser = data.user;
                    currentLanguage = currentUser.language || 'sw';
                    
                    localStorage.setItem('sila_token', authToken);
                    localStorage.setItem('sila_user', JSON.stringify(currentUser));
                    
                    showNotification('Umeingia kikamilifu!', 'success');
                    showChatPage();
                } else {
                    showNotification(data.error || 'Barua pepe au nenosiri sio sahihi', 'error');
                }
            } catch (error) {
                showNotification('Hitilafu ya mtandao. Tafadhali jaribu tena.', 'error');
            } finally {
                hideLoading();
            }
        }

        async function handleRegister(e) {
            e.preventDefault();
            showLoading();
            
            const username = document.getElementById('registerUsername').value.trim();
            const email = document.getElementById('registerEmail').value.trim();
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            const language = document.getElementById('registerLanguage').value;
            
            if (password !== confirmPassword) {
                showNotification('Nenosiri halifanani!', 'error');
                hideLoading();
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/api/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, email, password, language })
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    showNotification('Akaunti imeundwa kikamilifu!', 'success');
                    showLogin();
                } else {
                    showNotification(data.error || 'Hitilafu katika kujiandikisha', 'error');
                }
            } catch (error) {
                showNotification('Hitilafu ya mtandao. Tafadhali jaribu tena.', 'error');
            } finally {
                hideLoading();
            }
        }

        // Page navigation
        function showAuthPage() {
            document.getElementById('auth-page').style.display = 'flex';
            document.getElementById('chat-page').style.display = 'none';
            showLogin();
        }

        function showChatPage() {
            document.getElementById('auth-page').style.display = 'none';
            document.getElementById('chat-page').style.display = 'block';
            
            if (currentUser) {
                document.getElementById('menuUsername').textContent = currentUser.username;
                document.getElementById('menuEmail').textContent = currentUser.email;
                document.getElementById('menuAvatar').textContent = currentUser.username.charAt(0).toUpperCase();
            }
            
            updateUIForLanguage();
            closeMenu();
        }

        function showLogin() {
            document.getElementById('login-form').style.display = 'block';
            document.getElementById('register-form').style.display = 'none';
            document.getElementById('forgot-password-form').style.display = 'none';
        }

        function showRegister() {
            document.getElementById('login-form').style.display = 'none';
            document.getElementById('register-form').style.display = 'block';
            document.getElementById('forgot-password-form').style.display = 'none';
        }

        // Chat functions
        function generateSessionId() {
            return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function autoResizeTextarea() {
            const textarea = document.getElementById('messageInput');
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
        }

        function handleKeyDown(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        }

        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            addMessage('outgoing', message);
            input.value = '';
            input.style.height = 'auto';
            
            showTypingIndicator();
            
            try {
                const response = await fetch(`${API_URL}/api/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        message,
                        sessionId: currentSessionId,
                        generateImage: isImageMode,
                        generateVoice: isVoiceMode,
                        language: currentLanguage
                    })
                });
                
                const data = await response.json();
                
                removeTypingIndicator();
                
                if (data.success) {
                    if (data.isImage && data.imageUrl) {
                        addImageMessage(data.imageUrl, message);
                        showNotification(
                            currentLanguage === 'sw' ? 'Picha imetengenezwa!' : 'Image generated!',
                            'success'
                        );
                    } else if (data.isVoice && data.audioUrl) {
                        addVoiceMessage(data.audioUrl, data.response, message);
                        showNotification(
                            currentLanguage === 'sw' ? 'Sauti imetengenezwa!' : 'Voice generated!',
                            'success'
                        );
                    } else {
                        addMessage('incoming', data.response);
                    }
                } else {
                    addMessage('incoming', data.error || data.response || 
                        (currentLanguage === 'sw' ? 'Samahani, kuna hitilafu.' : 'Sorry, an error occurred.'));
                    
                    if (data.error && data.error.includes('unavailable')) {
                        showNotification(
                            currentLanguage === 'sw' 
                            ? 'API ya AI haipatikani kwa sasa. Tafadhali jaribu tena baada ya dakika chache.' 
                            : 'AI API is currently unavailable. Please try again in a few minutes.',
                            'warning'
                        );
                    }
                }
            } catch (error) {
                console.error('Send message error:', error);
                removeTypingIndicator();
                addMessage('incoming', 
                    currentLanguage === 'sw' 
                    ? 'Hitilafu ya mtandao. Tafadhali angalia muunganisho wako.' 
                    : 'Network error. Please check your connection.'
                );
                showNotification(
                    currentLanguage === 'sw' 
                    ? 'Hitilafu ya mtandao. Tafadhali jaribu tena.' 
                    : 'Network error. Please try again.',
                    'error'
                );
            }
        }

        function addMessage(type, content) {
            const container = document.getElementById('messagesContainer');
            
            const welcomeMessage = container.querySelector('.welcome-message');
            if (welcomeMessage && type === 'outgoing') {
                welcomeMessage.remove();
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            const now = new Date();
            const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            messageDiv.innerHTML = `
                <div class="message-bubble">${formatMessage(content)}</div>
                <div class="message-time">${timeString}</div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function addImageMessage(imageUrl, prompt) {
            const container = document.getElementById('messagesContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message incoming';
            
            const now = new Date();
            const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            messageDiv.innerHTML = `
                <div class="message-bubble">
                    <div class="image-message">
                        <img src="${imageUrl}" alt="Generated image" 
                             onerror="this.onerror=null; this.src='https://via.placeholder.com/512x512/007AFF/ffffff?text=Image+Generating...'">
                        <div class="image-prompt">
                            <strong>${currentLanguage === 'sw' ? 'Maelezo:' : 'Prompt:'}</strong> ${prompt}
                        </div>
                    </div>
                </div>
                <div class="message-time">${timeString}</div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function addVoiceMessage(audioUrl, text, prompt) {
            const container = document.getElementById('messagesContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message incoming';
            
            const now = new Date();
            const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            const shortText = text.length > 100 ? text.substring(0, 100) + '...' : text;
            
            messageDiv.innerHTML = `
                <div class="message-bubble">
                    <div class="voice-indicator">
                        <i class="fas fa-volume-up pulse-animation"></i>
                        <span>${currentLanguage === 'sw' ? 'Sauti imetengenezwa' : 'Voice generated'}</span>
                    </div>
                    <div class="audio-player">
                        <audio controls>
                            <source src="${audioUrl}" type="audio/mpeg">
                            ${currentLanguage === 'sw' ? 'Browser yako haitumiki audio' : 'Your browser does not support audio'}
                        </audio>
                    </div>
                    <div style="margin-top: 10px; font-size: 14px; color: rgba(255,255,255,0.8);">
                        <strong>${currentLanguage === 'sw' ? 'Maandishi:' : 'Text:'}</strong> ${shortText}
                    </div>
                    <div class="image-prompt">
                        <strong>${currentLanguage === 'sw' ? 'Maelezo:' : 'Prompt:'}</strong> ${prompt}
                    </div>
                </div>
                <div class="message-time">${timeString}</div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function showTypingIndicator() {
            const container = document.getElementById('messagesContainer');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message incoming';
            typingDiv.id = 'typingIndicator';
            
            typingDiv.innerHTML = `
                <div class="typing-indicator">
                    <span class="typing-dot"></span>
                    <span class="typing-dot"></span>
                    <span class="typing-dot"></span>
                </div>
            `;
            
            container.appendChild(typingDiv);
            container.scrollTop = container.scrollHeight;
        }

        function removeTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) {
                indicator.remove();
            }
        }

        function formatMessage(text) {
            return text
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/\n/g, '<br>')
                .replace(/(https?:\/\/[^\s]+)/g, url => 
                    `<a href="${url}" target="_blank" style="color: inherit; text-decoration: underline;">${url}</a>`
                );
        }

        // Mode functions
        function toggleImageMode() {
            isImageMode = !isImageMode;
            isVoiceMode = false;
            
            const imageBtn = document.getElementById('imageModeBtn');
            const voiceBtn = document.getElementById('voiceModeBtn');
            const input = document.getElementById('messageInput');
            
            if (isImageMode) {
                imageBtn.classList.add('active');
                if (voiceBtn) voiceBtn.classList.remove('active');
                input.placeholder = currentLanguage === 'sw' 
                    ? 'Andika maelezo ya picha unayotaka...' 
                    : 'Describe the image you want...';
                showNotification(
                    currentLanguage === 'sw' ? 'Hali ya picha imewashwa' : 'Image mode enabled',
                    'info'
                );
            } else {
                imageBtn.classList.remove('active');
                input.placeholder = currentLanguage === 'sw' 
                    ? 'Andika ujumbe wako hapa...' 
                    : 'Type your message here...';
                showNotification(
                    currentLanguage === 'sw' ? 'Hali ya picha imezimwa' : 'Image mode disabled',
                    'info'
                );
            }
        }

        function toggleVoiceMode() {
            isVoiceMode = !isVoiceMode;
            isImageMode = false;
            
            const imageBtn = document.getElementById('imageModeBtn');
            const voiceBtn = document.getElementById('voiceModeBtn') || createVoiceButton();
            const input = document.getElementById('messageInput');
            
            if (isVoiceMode) {
                voiceBtn.classList.add('active');
                if (imageBtn) imageBtn.classList.remove('active');
                input.placeholder = currentLanguage === 'sw' 
                    ? 'Andika maandishi ya kubadilisha kuwa sauti...' 
                    : 'Type text to convert to voice...';
                showNotification(
                    currentLanguage === 'sw' ? 'Hali ya sauti imewashwa' : 'Voice mode enabled',
                    'info'
                );
            } else {
                voiceBtn.classList.remove('active');
                input.placeholder = currentLanguage === 'sw' 
                    ? 'Andika ujumbe wako hapa...' 
                    : 'Type your message here...';
                showNotification(
                    currentLanguage === 'sw' ? 'Hali ya sauti imezimwa' : 'Voice mode disabled',
                    'info'
                );
            }
        }

        function createVoiceButton() {
            const inputContainer = document.querySelector('.input-container');
            const voiceBtn = document.createElement('button');
            voiceBtn.className = 'input-btn';
            voiceBtn.id = 'voiceModeBtn';
            voiceBtn.title = currentLanguage === 'sw' ? 'Hali ya Sauti' : 'Voice Mode';
            voiceBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
            voiceBtn.onclick = toggleVoiceMode;
            
            const imageBtn = document.getElementById('imageModeBtn');
            if (imageBtn) {
                inputContainer.insertBefore(voiceBtn, imageBtn.nextSibling);
            }
            
            return voiceBtn;
        }

        // Navigation functions
        function newChat() {
            currentSessionId = generateSessionId();
            document.getElementById('messagesContainer').innerHTML = `
                <div class="welcome-message">
                    <div class="welcome-icon">
                        <i class="fas fa-comment-medical"></i>
                    </div>
                    <h2 class="welcome-title" id="welcomeTitle">
                        ${currentLanguage === 'sw' ? 'Mazungumzo Mapya' : 'New Chat'}
                    </h2>
                    <p class="welcome-text" id="welcomeText">
                        ${currentLanguage === 'sw' 
                            ? 'Anza mazungumzo mapya na Sila AI. Nipo hapa kukusaidia!' 
                            : 'Start a new conversation with Sila AI. I\'m here to help!'}
                    </p>
                    <div class="welcome-actions">
                        <button class="welcome-btn" onclick="suggestPrompt('uniambie kuhusu wewe')">
                            <i class="fas fa-robot"></i>
                            <span id="welcomeLearn">${currentLanguage === 'sw' ? 'Jijulishe' : 'Learn About'}</span>
                        </button>
                        <button class="welcome-btn" onclick="suggestPrompt('nisaidie kutengeneza mpango wa kazi')">
                            <i class="fas fa-lightbulb"></i>
                            <span id="welcomeSuggest">${currentLanguage === 'sw' ? 'Pendekeza' : 'Suggest'}</span>
                        </button>
                        <button class="welcome-btn" onclick="toggleImageMode()">
                            <i class="fas fa-image"></i>
                            <span id="welcomeImage">${currentLanguage === 'sw' ? 'Tengeneza Picha' : 'Create Image'}</span>
                        </button>
                        <button class="welcome-btn" onclick="toggleVoiceMode()" id="welcomeVoiceBtn">
                            <i class="fas fa-volume-up"></i>
                            <span>${currentLanguage === 'sw' ? 'Tengeneza Sauti' : 'Create Voice'}</span>
                        </button>
                    </div>
                </div>
            `;
            closeMenu();
            
            // Reset modes
            isImageMode = false;
            isVoiceMode = false;
            const imageBtn = document.getElementById('imageModeBtn');
            const voiceBtn = document.getElementById('voiceModeBtn');
            if (imageBtn) imageBtn.classList.remove('active');
            if (voiceBtn) voiceBtn.classList.remove('active');
        }

        function suggestPrompt(prompt) {
            document.getElementById('messageInput').value = prompt;
            autoResizeTextarea();
        }

        // Test APIs directly
        async function testAPIs() {
            showLoading();
            try {
                // Test Chat API
                const chatResponse = await fetch(`${API_URL}/api/test/chat?text=Hello`);
                const chatData = await chatResponse.json();
                console.log('Chat API Test:', chatData);
                
                // Test Image API
                const imageResponse = await fetch(`${API_URL}/api/test/image?prompt=cat`);
                const imageData = await imageResponse.json();
                console.log('Image API Test:', imageData);
                
                // Test Voice API
                const voiceResponse = await fetch(`${API_URL}/api/test/voice?text=Hello world`);
                const voiceData = await voiceResponse.json();
                console.log('Voice API Test:', voiceData);
                
                showNotification('API tests completed', 'success');
            } catch (error) {
                console.error('API Test Error:', error);
                showNotification('API tests failed', 'error');
            } finally {
                hideLoading();
            }
        }

        // Server health check
        async function checkServerHealth() {
            try {
                const response = await fetch(`${API_URL}/api/health`);
                if (response.ok) {
                    document.getElementById('chatStatus').textContent = 
                        currentLanguage === 'sw' ? 'Inatumika' : 'Online';
                }
            } catch (error) {
                document.getElementById('chatStatus').textContent = 
                    currentLanguage === 'sw' ? 'Haitumiki' : 'Offline';
            }
        }

        function loadLanguage() {
            const savedLang = localStorage.getItem('sila_language') || 'sw';
            changeLanguage(savedLang);
        }

        function logout() {
            if (confirm(
                currentLanguage === 'sw' 
                    ? 'Unahakika unataka kutoka?' 
                    : 'Are you sure you want to logout?'
            )) {
                localStorage.removeItem('sila_token');
                localStorage.removeItem('sila_user');
                currentUser = null;
                authToken = null;
                showAuthPage();
                showNotification(
                    currentLanguage === 'sw' ? 'Umetoka kikamilifu' : 'Logged out successfully',
                    'info'
                );
            }
        }

        // Initialize voice button on chat page load
        if (document.getElementById('chat-page')) {
            setTimeout(() => {
                createVoiceButton();
            }, 1000);
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="sw">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sila AI - Msaidizi Wako Wa Kisasa</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        :root {
            --primary-color: #007AFF;
            --secondary-color: #34C759;
            --accent-color: #5856D6;
            --danger-color: #FF3B30;
            --warning-color: #FF9500;
            
            --bg-color: #0B0B0B;
            --card-color: #1C1C1E;
            --message-in: #2B2B2D;
            --message-out: #007AFF;
            --text-primary: #FFFFFF;
            --text-secondary: #8E8E93;
            --border-color: #3A3A3C;
            
            --header-height: 60px;
            --input-height: 60px;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
        }

        /* Notification System */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            max-width: 350px;
        }

        .notification {
            background: var(--card-color);
            border-left: 4px solid var(--primary-color);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .notification.error {
            border-left-color: var(--danger-color);
        }

        .notification.success {
            border-left-color: var(--secondary-color);
        }

        .notification.warning {
            border-left-color: var(--warning-color);
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .notification-message {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .notification-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 4px;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Main App Container */
        .app-container {
            display: flex;
            height: 100vh;
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
        }

        /* Menu Toggle Button */
        .menu-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--card-color);
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1000;
            color: var(--text-primary);
            font-size: 20px;
            transition: all 0.3s;
        }

        .menu-toggle:hover {
            background: var(--border-color);
            transform: scale(1.05);
        }

        /* Sidebar Menu */
        .sidebar-menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 280px;
            height: 100%;
            background: var(--card-color);
            transform: translateX(-100%);
            transition: transform 0.3s ease;
            z-index: 999;
            padding: 80px 20px 20px;
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border-color);
        }

        .sidebar-menu.active {
            transform: translateX(0);
        }

        .menu-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .menu-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: bold;
        }

        .menu-username {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .menu-email {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .menu-items {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: 16px;
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.3s;
            text-align: left;
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .menu-item.active {
            background: rgba(0, 122, 255, 0.15);
            color: var(--primary-color);
        }

        .menu-item i {
            width: 24px;
            font-size: 18px;
        }

        .menu-footer {
            margin-top: auto;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .language-selector {
            position: fixed;
            top: 20px;
            right: 80px;
            z-index: 1000;
        }

        .language-btn {
            background: var(--card-color);
            border: none;
            padding: 10px 20px;
            border-radius: 12px;
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .language-btn:hover {
            background: var(--border-color);
        }

        /* Main Chat Area */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100vh;
            margin-left: 0;
            transition: margin-left 0.3s;
        }

        .chat-container.menu-open {
            margin-left: 280px;
        }

        /* Chat Header */
        .chat-header {
            height: var(--header-height);
            background: var(--card-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .chat-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .chat-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
        }

        .chat-title {
            font-size: 18px;
            font-weight: 600;
        }

        .chat-status {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .chat-actions {
            display: flex;
            gap: 10px;
        }

        .header-btn {
            background: transparent;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-primary);
            font-size: 18px;
            transition: all 0.3s;
        }

        .header-btn:hover {
            background: var(--border-color);
        }

        /* Messages Container */
        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: var(--bg-color);
        }

        .welcome-message {
            text-align: center;
            padding: 40px 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        .welcome-icon {
            font-size: 80px;
            margin-bottom: 20px;
            color: var(--primary-color);
            opacity: 0.8;
        }

        .welcome-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 15px;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .welcome-text {
            font-size: 16px;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .welcome-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .welcome-btn {
            padding: 12px 24px;
            background: var(--card-color);
            border: none;
            border-radius: 25px;
            color: var(--text-primary);
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .welcome-btn:hover {
            background: var(--border-color);
            transform: translateY(-2px);
        }

        /* Message Bubbles */
        .message {
            max-width: 70%;
            display: flex;
            flex-direction: column;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.outgoing {
            align-self: flex-end;
        }

        .message.incoming {
            align-self: flex-start;
        }

        .message-bubble {
            padding: 12px 16px;
            border-radius: 18px;
            position: relative;
            word-wrap: break-word;
            white-space: pre-wrap;
            line-height: 1.5;
        }

        .message.outgoing .message-bubble {
            background: var(--message-out);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message.incoming .message-bubble {
            background: var(--message-in);
            color: var(--text-primary);
            border-bottom-left-radius: 4px;
        }

        .message-time {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 4px;
            text-align: right;
            padding: 0 4px;
        }

        .message.outgoing .message-time {
            color: rgba(255, 255, 255, 0.7);
        }

        .image-message {
            margin-top: 10px;
        }

        .image-message img {
            max-width: 100%;
            border-radius: 12px;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .image-message img:hover {
            transform: scale(1.02);
        }

        .image-prompt {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 8px;
            font-style: italic;
        }

        /* Typing Indicator */
        .typing-indicator {
            background: var(--message-in);
            padding: 12px 16px;
            border-radius: 18px;
            border-bottom-left-radius: 4px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            max-width: 100px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--text-secondary);
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typing {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        /* Input Container */
        .input-container {
            height: var(--input-height);
            background: var(--card-color);
            border-top: 1px solid var(--border-color);
            padding: 10px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            position: sticky;
            bottom: 0;
            z-index: 100;
        }

        .message-input {
            flex: 1;
            height: 40px;
            padding: 0 15px;
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            color: var(--text-primary);
            font-size: 16px;
            outline: none;
            resize: none;
            line-height: 40px;
            max-height: 120px;
            overflow-y: auto;
        }

        .message-input:focus {
            border-color: var(--primary-color);
        }

        .input-btn {
            background: transparent;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-primary);
            font-size: 18px;
            transition: all 0.3s;
        }

        .input-btn:hover {
            background: var(--border-color);
        }

        .input-btn.active {
            background: var(--primary-color);
            color: white;
        }

        .input-btn.send {
            background: var(--primary-color);
            color: white;
        }

        .input-btn.send:hover {
            background: #0056CC;
            transform: scale(1.05);
        }

        .input-btn.voice {
            background: var(--secondary-color);
            color: white;
        }

        .input-btn.voice:hover {
            background: #2A9E4B;
        }

        .input-btn.recording {
            background: var(--danger-color);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Mode Indicator */
        .mode-indicator {
            position: absolute;
            top: -25px;
            left: 20px;
            background: var(--accent-color);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        /* Auth Pages */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #1a1a1a, #2d2d2d);
            padding: 20px;
        }

        .auth-box {
            background: var(--card-color);
            padding: 40px;
            border-radius: 20px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .auth-logo {
            font-size: 48px;
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .auth-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .auth-subtitle {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .auth-language {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }

        .lang-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 20px;
            color: var(--text-primary);
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .lang-btn.active {
            background: var(--primary-color);
            color: white;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 16px;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .auth-btn {
            width: 100%;
            padding: 14px;
            background: var(--primary-color);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .auth-btn:hover {
            background: #0056CC;
            transform: translateY(-2px);
        }

        .auth-links {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            font-size: 14px;
        }

        .auth-link {
            color: var(--primary-color);
            text-decoration: none;
            cursor: pointer;
        }

        .auth-link:hover {
            text-decoration: underline;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .app-container {
                max-width: 100%;
            }
            
            .menu-toggle {
                top: 10px;
                left: 10px;
            }
            
            .language-selector {
                top: 10px;
                right: 60px;
            }
            
            .sidebar-menu {
                width: 100%;
            }
            
            .chat-container.menu-open {
                margin-left: 0;
            }
            
            .message {
                max-width: 85%;
            }
            
            .input-container {
                padding: 10px;
            }
            
            .auth-box {
                padding: 30px 20px;
            }
        }

        @media (max-width: 480px) {
            .welcome-title {
                font-size: 24px;
            }
            
            .welcome-actions {
                flex-direction: column;
            }
            
            .welcome-btn {
                width: 100%;
                justify-content: center;
            }
            
            .message {
                max-width: 90%;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        /* File Upload */
        .file-input {
            display: none;
        }

        /* History Modal */
        .history-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: 20px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .history-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .history-content {
            background: var(--card-color);
            border-radius: 20px;
            width: 100%;
            max-width: 500px;
            max-height: 80vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .history-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-title {
            font-size: 20px;
            font-weight: 600;
        }

        .history-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 24px;
            cursor: pointer;
            padding: 4px;
        }

        .history-list {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .history-item {
            padding: 15px;
            background: var(--bg-color);
            border-radius: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .history-item:hover {
            background: var(--border-color);
        }

        .history-item-title {
            font-weight: 500;
            margin-bottom: 5px;
        }

        .history-item-date {
            font-size: 12px;
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <!-- Notification Container -->
    <div class="notification-container" id="notificationContainer"></div>
    
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>
    
    <!-- History Modal -->
    <div class="history-modal" id="historyModal">
        <div class="history-content">
            <div class="history-header">
                <h2 class="history-title" id="historyTitle">Historia ya Mazungumzo</h2>
                <button class="history-close" onclick="closeHistoryModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="history-list" id="historyList">
                <!-- History items will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Authentication Pages -->
    <div id="auth-page" class="auth-container" style="display: none;">
        <div class="auth-language">
            <button class="lang-btn active" data-lang="sw">SW</button>
            <button class="lang-btn" data-lang="en">EN</button>
        </div>
        
        <div class="auth-box">
            <div class="auth-header">
                <div class="auth-logo">
                    <i class="fas fa-robot"></i>
                </div>
                <h1 class="auth-title">Sila AI</h1>
                <p class="auth-subtitle">Msaidizi wako wa kisasa wa 2026</p>
            </div>
            
            <div id="login-form">
                <form id="loginForm">
                    <div class="form-group">
                        <label class="form-label" id="loginEmailLabel">Barua Pepe</label>
                        <input type="email" id="loginEmail" class="form-control" placeholder="weka@email.com" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" id="loginPasswordLabel">Nenosiri</label>
                        <input type="password" id="loginPassword" class="form-control" placeholder="••••••••" required>
                    </div>
                    <button type="submit" class="auth-btn" id="loginButton">Ingia</button>
                </form>
                
                <div class="auth-links">
                    <a href="#" class="auth-link" onclick="showRegister()" id="registerLink">Jisajiri</a>
                    <a href="#" class="auth-link" onclick="showForgotPassword()" id="forgotLink">Umesahau nenosiri?</a>
                </div>
            </div>
            
            <div id="register-form" style="display: none;">
                <form id="registerForm">
                    <div class="form-group">
                        <label class="form-label" id="registerUsernameLabel">Jina la Mtumiaji</label>
                        <input type="text" id="registerUsername" class="form-control" placeholder="jina lako" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" id="registerEmailLabel">Barua Pepe</label>
                        <input type="email" id="registerEmail" class="form-control" placeholder="weka@email.com" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" id="registerPasswordLabel">Nenosiri</label>
                        <input type="password" id="registerPassword" class="form-control" placeholder="••••••••" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" id="registerConfirmLabel">Thibitisha Nenosiri</label>
                        <input type="password" id="registerConfirmPassword" class="form-control" placeholder="••••••••" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" id="registerLanguageLabel">Chagua Lugha</label>
                        <select id="registerLanguage" class="form-control">
                            <option value="sw">Kiswahili</option>
                            <option value="en">English</option>
                        </select>
                    </div>
                    <button type="submit" class="auth-btn" id="registerButton">Jisajiri</button>
                </form>
                
                <div class="auth-links">
                    <a href="#" class="auth-link" onclick="showLogin()" id="loginLink">Tayari una akaunti? Ingia</a>
                </div>
            </div>
            
            <div id="forgot-password-form" style="display: none;">
                <form id="forgotPasswordForm">
                    <div class="form-group">
                        <label class="form-label" id="forgotEmailLabel">Barua Pepe Yako</label>
                        <input type="email" id="forgotEmail" class="form-control" placeholder="weka@email.com" required>
                    </div>
                    <button type="submit" class="auth-btn" id="forgotButton">Tuma Maelekezo</button>
                </form>
                
                <div class="auth-links">
                    <a href="#" class="auth-link" onclick="showLogin()" id="backToLoginLink">Rudi kwenye kuingia</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Chat Interface -->
    <div id="chat-page" style="display: none;">
        <!-- Menu Toggle Button -->
        <button class="menu-toggle" onclick="toggleMenu()">
            <i class="fas fa-bars"></i>
        </button>
        
        <!-- Language Selector -->
        <div class="language-selector">
            <button class="language-btn" onclick="toggleLanguageDropdown()">
                <i class="fas fa-globe"></i>
                <span id="currentLanguage">SW</span>
            </button>
        </div>
        
        <!-- Sidebar Menu -->
        <div class="sidebar-menu" id="sidebarMenu">
            <div class="menu-header">
                <div class="menu-avatar" id="menuAvatar">U</div>
                <div class="menu-username" id="menuUsername">Mtumiaji</div>
                <div class="menu-email" id="menuEmail">email@example.com</div>
            </div>
            
            <div class="menu-items">
                <button class="menu-item active" onclick="newChat()">
                    <i class="fas fa-plus-circle"></i>
                    <span id="menuNewChat">Mazungumzo Mapya</span>
                </button>
                <button class="menu-item" onclick="showHistory()">
                    <i class="fas fa-history"></i>
                    <span id="menuHistory">Historia ya Mazungumzo</span>
                </button>
                <button class="menu-item" onclick="uploadFile()">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <span id="menuUpload">Pakia Faili</span>
                </button>
                <button class="menu-item" onclick="contactDeveloper()">
                    <i class="fab fa-whatsapp"></i>
                    <span id="menuContact">Wasiliana na Developer</span>
                </button>
                <button class="menu-item" onclick="showSettings()">
                    <i class="fas fa-cog"></i>
                    <span id="menuSettings">Mipangilio</span>
                </button>
            </div>
            
            <div class="menu-footer">
                <button class="menu-item" style="color: #FF3B30;" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span id="menuLogout">Toka</span>
                </button>
            </div>
        </div>
        
        <!-- Main Chat Container -->
        <div class="chat-container" id="chatContainer">
            <!-- Chat Header -->
            <div class="chat-header">
                <div class="chat-info">
                    <div class="chat-avatar">S</div>
                    <div>
                        <div class="chat-title">Sila AI</div>
                        <div class="chat-status" id="chatStatus">Inatumika</div>
                    </div>
                </div>
                <div class="chat-actions">
                    <button class="header-btn" onclick="toggleTheme()" title="Badilisha muonekano">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
            </div>
            
            <!-- Messages Container -->
            <div class="messages-container" id="messagesContainer">
                <div class="welcome-message">
                    <div class="welcome-icon">
                        <i class="fas fa-robot"></i>
                    </div>
                    <h2 class="welcome-title" id="welcomeTitle">Karibu kwenye Sila AI 2026</h2>
                    <p class="welcome-text" id="welcomeText">
                        Mimi ni Sila AI, msaidizi wako wa kisasa wa 2026. Nina uwezo wa kukumbuka mazungumzo, 
                        kutengeneza picha, kusoma faili, na kukusaidia katika kila jambo. Tuongee!
                    </p>
                    <div class="welcome-actions">
                        <button class="welcome-btn" onclick="suggestPrompt('uniambie kuhusu wewe')">
                            <i class="fas fa-robot"></i>
                            <span id="welcomeLearn">Jijulishe</span>
                        </button>
                        <button class="welcome-btn" onclick="suggestPrompt('nisaidie kutengeneza mpango wa kazi')">
                            <i class="fas fa-lightbulb"></i>
                            <span id="welcomeSuggest">Pendekeza</span>
                        </button>
                        <button class="welcome-btn" onclick="toggleImageMode()">
                            <i class="fas fa-image"></i>
                            <span id="welcomeImage">Tengeneza Picha</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Input Container -->
            <div class="input-container">
                <input type="file" id="fileInput" class="file-input" multiple onchange="handleFileUpload()">
                <button class="input-btn" onclick="uploadFile()" title="Pakia Faili">
                    <i class="fas fa-paperclip"></i>
                </button>
                <button class="input-btn" id="imageModeBtn" onclick="toggleImageMode()" title="Hali ya Picha">
                    <i class="fas fa-image"></i>
                </button>
                <textarea 
                    id="messageInput" 
                    class="message-input" 
                    placeholder="Andika ujumbe wako hapa..." 
                    rows="1"
                    onkeydown="handleKeyDown(event)"
                ></textarea>
                <button class="input-btn voice" id="voiceBtn" onclick="toggleVoiceInput()" title="Sema">
                    <i class="fas fa-microphone"></i>
                </button>
                <button class="input-btn send" onclick="sendMessage()" title="Tuma">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const API_URL = window.location.origin;
        let currentSessionId = generateSessionId();
        let isImageMode = false;
        let isRecording = false;
        let recognition = null;
        let currentUser = null;
        let authToken = null;
        let currentLanguage = 'sw';
        let isMenuOpen = false;
        let isDarkMode = true;

        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            checkAuthStatus();
            setupEventListeners();
            loadTheme();
            loadLanguage();
            checkServerHealth();
        });

        // Setup event listeners
        function setupEventListeners() {
            // Auto-resize textarea
            const textarea = document.getElementById('messageInput');
            textarea.addEventListener('input', autoResizeTextarea);
            
            // Auth language buttons
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    const lang = this.dataset.lang;
                    updateAuthLanguage(lang);
                });
            });
            
            // Auth forms
            document.getElementById('loginForm')?.addEventListener('submit', handleLogin);
            document.getElementById('registerForm')?.addEventListener('submit', handleRegister);
            document.getElementById('forgotPasswordForm')?.addEventListener('submit', handleForgotPassword);
        }

        // Notification System
        function showNotification(message, type = 'info', duration = 5000) {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <div class="notification-title">${type.charAt(0).toUpperCase() + type.slice(1)}</div>
                    <div class="notification-message">${message}</div>
                </div>
                <button class="notification-close" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            container.appendChild(notification);
            
            // Auto remove
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, duration);
        }

        // Loading overlay
        function showLoading() {
            document.getElementById('loadingOverlay').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }

        // Language functions
        function changeLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('sila_language', lang);
            document.getElementById('currentLanguage').textContent = lang.toUpperCase();
            updateUIForLanguage();
            
            // Update voice recognition language
            if (recognition) {
                recognition.lang = lang === 'sw' ? 'sw-TZ' : 'en-US';
            }
            
            showNotification(
                lang === 'sw' ? 'Lugha imebadilishwa kuwa Kiswahili' : 'Language changed to English',
                'success'
            );
        }

        function toggleLanguageDropdown() {
            // Simple toggle between languages
            const newLang = currentLanguage === 'sw' ? 'en' : 'sw';
            changeLanguage(newLang);
        }

        function updateUIForLanguage() {
            const translations = {
                sw: {
                    newChat: 'Mazungumzo Mapya',
                    history: 'Historia ya Mazungumzo',
                    upload: 'Pakia Faili',
                    contact: 'Wasiliana na Developer',
                    settings: 'Mipangilio',
                    logout: 'Toka',
                    placeholder: 'Andika ujumbe wako hapa...',
                    imagePlaceholder: 'Andika maelezo ya picha...',
                    welcomeTitle: 'Karibu kwenye Sila AI 2026',
                    welcomeText: 'Mimi ni Sila AI, msaidizi wako wa kisasa wa 2026. Nina uwezo wa kukumbuka mazungumzo, kutengeneza picha, kusoma faili, na kukusaidia katika kila jambo. Tuongee!',
                    welcomeLearn: 'Jijulishe',
                    welcomeSuggest: 'Pendekeza',
                    welcomeImage: 'Tengeneza Picha',
                    chatStatus: 'Inatumika',
                    historyTitle: 'Historia ya Mazungumzo'
                },
                en: {
                    newChat: 'New Chat',
                    history: 'Chat History',
                    upload: 'Upload File',
                    contact: 'Contact Developer',
                    settings: 'Settings',
                    logout: 'Logout',
                    placeholder: 'Type your message here...',
                    imagePlaceholder: 'Describe the image...',
                    welcomeTitle: 'Welcome to Sila AI 2026',
                    welcomeText: 'I am Sila AI, your modern 2026 assistant. I can remember conversations, generate images, read files, and help you with everything. Let\'s talk!',
                    welcomeLearn: 'Learn About',
                    welcomeSuggest: 'Suggest',
                    welcomeImage: 'Create Image',
                    chatStatus: 'Online',
                    historyTitle: 'Chat History'
                }
            };
            
            const trans = translations[currentLanguage] || translations.sw;
            
            // Update menu items
            document.getElementById('menuNewChat').textContent = trans.newChat;
            document.getElementById('menuHistory').textContent = trans.history;
            document.getElementById('menuUpload').textContent = trans.upload;
            document.getElementById('menuContact').textContent = trans.contact;
            document.getElementById('menuSettings').textContent = trans.settings;
            document.getElementById('menuLogout').textContent = trans.logout;
            
            // Update input placeholder
            const input = document.getElementById('messageInput');
            input.placeholder = trans.placeholder;
            
            // Update welcome message
            document.getElementById('welcomeTitle').textContent = trans.welcomeTitle;
            document.getElementById('welcomeText').textContent = trans.welcomeText;
            document.getElementById('welcomeLearn').textContent = trans.welcomeLearn;
            document.getElementById('welcomeSuggest').textContent = trans.welcomeSuggest;
            document.getElementById('welcomeImage').textContent = trans.welcomeImage;
            
            // Update chat status
            document.getElementById('chatStatus').textContent = trans.chatStatus;
            
            // Update history modal title
            document.getElementById('historyTitle').textContent = trans.historyTitle;
        }

        function updateAuthLanguage(lang) {
            currentLanguage = lang;
            const translations = {
                sw: {
                    loginEmailLabel: 'Barua Pepe',
                    loginPasswordLabel: 'Nenosiri',
                    loginButton: 'Ingia',
                    registerLink: 'Jisajiri',
                    forgotLink: 'Umesahau nenosiri?',
                    registerUsernameLabel: 'Jina la Mtumiaji',
                    registerEmailLabel: 'Barua Pepe',
                    registerPasswordLabel: 'Nenosiri',
                    registerConfirmLabel: 'Thibitisha Nenosiri',
                    registerLanguageLabel: 'Chagua Lugha',
                    registerButton: 'Jisajiri',
                    loginLink: 'Tayari una akaunti? Ingia',
                    forgotEmailLabel: 'Barua Pepe Yako',
                    forgotButton: 'Tuma Maelekezo',
                    backToLoginLink: 'Rudi kwenye kuingia'
                },
                en: {
                    loginEmailLabel: 'Email',
                    loginPasswordLabel: 'Password',
                    loginButton: 'Login',
                    registerLink: 'Register',
                    forgotLink: 'Forgot Password?',
                    registerUsernameLabel: 'Username',
                    registerEmailLabel: 'Email',
                    registerPasswordLabel: 'Password',
                    registerConfirmLabel: 'Confirm Password',
                    registerLanguageLabel: 'Choose Language',
                    registerButton: 'Register',
                    loginLink: 'Already have an account? Login',
                    forgotEmailLabel: 'Your Email',
                    forgotButton: 'Send Instructions',
                    backToLoginLink: 'Back to Login'
                }
            };
            
            const trans = translations[lang] || translations.sw;
            
            // Update auth form labels
            Object.keys(trans).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    element.textContent = trans[key];
                }
            });
        }

        // Theme functions
        function toggleTheme() {
            isDarkMode = !isDarkMode;
            document.body.style.backgroundColor = isDarkMode ? '#0B0B0B' : '#FFFFFF';
            document.body.style.color = isDarkMode ? '#FFFFFF' : '#000000';
            
            const themeIcon = document.querySelector('.header-btn i');
            themeIcon.className = isDarkMode ? 'fas fa-sun' : 'fas fa-moon';
            
            localStorage.setItem('sila_theme', isDarkMode ? 'dark' : 'light');
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('sila_theme') || 'dark';
            isDarkMode = savedTheme === 'dark';
            
            if (!isDarkMode) {
                document.body.style.backgroundColor = '#FFFFFF';
                document.body.style.color = '#000000';
                document.querySelector('.header-btn i').className = 'fas fa-sun';
            }
        }

        // Menu functions
        function toggleMenu() {
            isMenuOpen = !isMenuOpen;
            const sidebar = document.getElementById('sidebarMenu');
            const chatContainer = document.getElementById('chatContainer');
            
            if (isMenuOpen) {
                sidebar.classList.add('active');
                chatContainer.classList.add('menu-open');
            } else {
                sidebar.classList.remove('active');
                chatContainer.classList.remove('menu-open');
            }
        }

        // Authentication functions
        async function checkAuthStatus() {
            const token = localStorage.getItem('sila_token');
            const user = localStorage.getItem('sila_user');
            
            if (token && user) {
                try {
                    // Validate token
                    const response = await fetch(`${API_URL}/api/health`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    
                    if (response.ok) {
                        authToken = token;
                        currentUser = JSON.parse(user);
                        currentLanguage = currentUser.language || 'sw';
                        showChatPage();
                    } else {
                        localStorage.removeItem('sila_token');
                        localStorage.removeItem('sila_user');
                        showAuthPage();
                    }
                } catch (error) {
                    showNotification('Hitilafu ya mtandao. Tafadhali angalia muunganisho wako.', 'error');
                    showAuthPage();
                }
            } else {
                showAuthPage();
            }
        }

        async function handleLogin(e) {
            e.preventDefault();
            showLoading();
            
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            try {
                const response = await fetch(`${API_URL}/api/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    authToken = data.token;
                    currentUser = data.user;
                    currentLanguage = currentUser.language || 'sw';
                    
                    localStorage.setItem('sila_token', authToken);
                    localStorage.setItem('sila_user', JSON.stringify(currentUser));
                    
                    showNotification('Umeingia kikamilifu!', 'success');
                    showChatPage();
                } else {
                    showNotification(data.error || 'Barua pepe au nenosiri sio sahihi', 'error');
                }
            } catch (error) {
                showNotification('Hitilafu ya mtandao. Tafadhali jaribu tena.', 'error');
            } finally {
                hideLoading();
            }
        }

        async function handleRegister(e) {
            e.preventDefault();
            showLoading();
            
            const username = document.getElementById('registerUsername').value.trim();
            const email = document.getElementById('registerEmail').value.trim();
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            const language = document.getElementById('registerLanguage').value;
            
            // Validation
            if (password !== confirmPassword) {
                showNotification('Nenosiri halifanani!', 'error');
                hideLoading();
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/api/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, email, password, language })
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    showNotification('Akaunti imeundwa kikamilifu!', 'success');
                    showLogin();
                } else {
                    showNotification(data.error || 'Hitilafu katika kujiandikisha', 'error');
                }
            } catch (error) {
                showNotification('Hitilafu ya mtandao. Tafadhali jaribu tena.', 'error');
            } finally {
                hideLoading();
            }
        }

        async function handleForgotPassword(e) {
            e.preventDefault();
            showLoading();
            
            const email = document.getElementById('forgotEmail').value.trim();
            
            try {
                // This endpoint needs to be implemented on the server
                const response = await fetch(`${API_URL}/api/forgot-password`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showNotification(
                        currentLanguage === 'sw' 
                            ? 'Maelekezo yametumwa kwenye email yako' 
                            : 'Instructions sent to your email',
                        'success'
                    );
                    showLogin();
                } else {
                    showNotification(data.error || 'Hitilafu katika kutuma maelekezo', 'error');
                }
            } catch (error) {
                showNotification('Hitilafu ya mtandao. Tafadhali jaribu tena.', 'error');
            } finally {
                hideLoading();
            }
        }

        // Page navigation
        function showAuthPage() {
            document.getElementById('auth-page').style.display = 'flex';
            document.getElementById('chat-page').style.display = 'none';
            showLogin();
        }

        function showChatPage() {
            document.getElementById('auth-page').style.display = 'none';
            document.getElementById('chat-page').style.display = 'block';
            
            if (currentUser) {
                document.getElementById('menuUsername').textContent = currentUser.username;
                document.getElementById('menuEmail').textContent = currentUser.email;
                document.getElementById('menuAvatar').textContent = currentUser.username.charAt(0).toUpperCase();
            }
            
            updateUIForLanguage();
            closeMenu();
        }

        function showLogin() {
            document.getElementById('login-form').style.display = 'block';
            document.getElementById('register-form').style.display = 'none';
            document.getElementById('forgot-password-form').style.display = 'none';
        }

        function showRegister() {
            document.getElementById('login-form').style.display = 'none';
            document.getElementById('register-form').style.display = 'block';
            document.getElementById('forgot-password-form').style.display = 'none';
        }

        function showForgotPassword() {
            document.getElementById('login-form').style.display = 'none';
            document.getElementById('register-form').style.display = 'none';
            document.getElementById('forgot-password-form').style.display = 'block';
        }

        function closeMenu() {
            isMenuOpen = false;
            document.getElementById('sidebarMenu').classList.remove('active');
            document.getElementById('chatContainer').classList.remove('menu-open');
        }

        // Chat functions
        function generateSessionId() {
            return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function autoResizeTextarea() {
            const textarea = document.getElementById('messageInput');
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
        }

        function handleKeyDown(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        }

        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message to chat
            addMessage('outgoing', message);
            input.value = '';
            input.style.height = 'auto';
            
            // Show typing indicator
            showTypingIndicator();
            
            try {
                const response = await fetch(`${API_URL}/api/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        message,
                        sessionId: currentSessionId,
                        generateImage: isImageMode,
                        language: currentLanguage
                    })
                });
                
                const data = await response.json();
                
                // Remove typing indicator
                removeTypingIndicator();
                
                if (data.success) {
                    if (data.isImage && data.imageUrl) {
                        addImageMessage(data.imageUrl, message);
                        showNotification(
                            currentLanguage === 'sw' ? 'Picha imetengenezwa!' : 'Image generated!',
                            'success'
                        );
                    } else {
                        addMessage('incoming', data.response);
                    }
                } else {
                    addMessage('incoming', data.error || data.response || 
                        (currentLanguage === 'sw' ? 'Samahani, kuna hitilafu.' : 'Sorry, an error occurred.'));
                    
                    if (data.error) {
                        showNotification(data.error, 'error');
                    }
                }
            } catch (error) {
                console.error('Send message error:', error);
                removeTypingIndicator();
                addMessage('incoming', 
                    currentLanguage === 'sw' 
                    ? 'Hitilafu ya mtandao. Tafadhali angalia muunganisho wako.' 
                    : 'Network error. Please check your connection.'
                );
                showNotification(
                    currentLanguage === 'sw' 
                    ? 'Hitilafu ya mtandao. Tafadhali jaribu tena.' 
                    : 'Network error. Please try again.',
                    'error'
                );
            }
        }

        function addMessage(type, content) {
            const container = document.getElementById('messagesContainer');
            
            // Remove welcome message if it's the first user message
            const welcomeMessage = container.querySelector('.welcome-message');
            if (welcomeMessage && type === 'outgoing') {
                welcomeMessage.remove();
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            const now = new Date();
            const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            messageDiv.innerHTML = `
                <div class="message-bubble">${formatMessage(content)}</div>
                <div class="message-time">${timeString}</div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function addImageMessage(imageUrl, prompt) {
            const container = document.getElementById('messagesContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message incoming';
            
            const now = new Date();
            const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            messageDiv.innerHTML = `
                <div class="message-bubble">
                    <div class="image-message">
                        <img src="${imageUrl}" alt="Generated image" 
                             onerror="this.onerror=null; this.src='https://via.placeholder.com/400x400/007AFF/ffffff?text=Image+Error'">
                        <div class="image-prompt">
                            <strong>${currentLanguage === 'sw' ? 'Maelezo:' : 'Prompt:'}</strong> ${prompt}
                        </div>
                    </div>
                </div>
                <div class="message-time">${timeString}</div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function showTypingIndicator() {
            const container = document.getElementById('messagesContainer');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message incoming';
            typingDiv.id = 'typingIndicator';
            
            typingDiv.innerHTML = `
                <div class="typing-indicator">
                    <span class="typing-dot"></span>
                    <span class="typing-dot"></span>
                    <span class="typing-dot"></span>
                </div>
            `;
            
            container.appendChild(typingDiv);
            container.scrollTop = container.scrollHeight;
        }

        function removeTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) {
                indicator.remove();
            }
        }

        function formatMessage(text) {
            return text
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/\n/g, '<br>')
                .replace(/(https?:\/\/[^\s]+)/g, url => 
                    `<a href="${url}" target="_blank" style="color: inherit; text-decoration: underline;">${url}</a>`
                );
        }

        // Voice functions
        function setupVoiceRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = currentLanguage === 'sw' ? 'sw-TZ' : 'en-US';
                
                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    document.getElementById('messageInput').value = transcript;
                    autoResizeTextarea();
                };
                
                recognition.onerror = (event) => {
                    console.error('Voice recognition error:', event.error);
                    showNotification(
                        currentLanguage === 'sw' 
                            ? 'Sauti haitumiki kwenye browser yako' 
                            : 'Voice not supported in your browser',
                        'error'
                    );
                    stopVoiceRecording();
                };
            }
        }

        function toggleVoiceInput() {
            if (!recognition) {
                setupVoiceRecognition();
            }
            
            if (!recognition) {
                showNotification(
                    currentLanguage === 'sw' 
                        ? 'Sauti haitumiki kwenye browser yako' 
                        : 'Voice not supported in your browser',
                    'error'
                );
                return;
            }
            
            if (!isRecording) {
                startVoiceRecording();
            } else {
                stopVoiceRecording();
            }
        }

        function startVoiceRecording() {
            try {
                recognition.lang = currentLanguage === 'sw' ? 'sw-TZ' : 'en-US';
                recognition.start();
                isRecording = true;
                
                const voiceBtn = document.getElementById('voiceBtn');
                voiceBtn.innerHTML = '<i class="fas fa-stop"></i>';
                voiceBtn.classList.add('recording');
                voiceBtn.classList.remove('voice');
                
                showNotification(
                    currentLanguage === 'sw' 
                        ? 'Anza kusema sasa...' 
                        : 'Start speaking now...',
                    'info'
                );
            } catch (error) {
                showNotification(
                    currentLanguage === 'sw' 
                        ? 'Hitilafu ya kuanza sauti' 
                        : 'Error starting voice',
                    'error'
                );
            }
        }

        function stopVoiceRecording() {
            if (recognition) {
                recognition.stop();
            }
            isRecording = false;
            
            const voiceBtn = document.getElementById('voiceBtn');
            voiceBtn.innerHTML = '<i class="fas fa-microphone"></i>';
            voiceBtn.classList.remove('recording');
            voiceBtn.classList.add('voice');
        }

        // Navigation functions
        function newChat() {
            currentSessionId = generateSessionId();
            document.getElementById('messagesContainer').innerHTML = `
                <div class="welcome-message">
                    <div class="welcome-icon">
                        <i class="fas fa-comment-medical"></i>
                    </div>
                    <h2 class="welcome-title" id="welcomeTitle">
                        ${currentLanguage === 'sw' ? 'Mazungumzo Mapya' : 'New Chat'}
                    </h2>
                    <p class="welcome-text" id="welcomeText">
                        ${currentLanguage === 'sw' 
                            ? 'Anza mazungumzo mapya na Sila AI. Nipo hapa kukusaidia!' 
                            : 'Start a new conversation with Sila AI. I\'m here to help!'}
                    </p>
                    <div class="welcome-actions">
                        <button class="welcome-btn" onclick="suggestPrompt('uniambie kuhusu wewe')">
                            <i class="fas fa-robot"></i>
                            <span id="welcomeLearn">${currentLanguage === 'sw' ? 'Jijulishe' : 'Learn About'}</span>
                        </button>
                        <button class="welcome-btn" onclick="suggestPrompt('nisaidie kutengeneza mpango wa kazi')">
                            <i class="fas fa-lightbulb"></i>
                            <span id="welcomeSuggest">${currentLanguage === 'sw' ? 'Pendekeza' : 'Suggest'}</span>
                        </button>
                        <button class="welcome-btn" onclick="toggleImageMode()">
                            <i class="fas fa-image"></i>
                            <span id="welcomeImage">${currentLanguage === 'sw' ? 'Tengeneza Picha' : 'Create Image'}</span>
                        </button>
                    </div>
                </div>
            `;
            closeMenu();
        }

        function suggestPrompt(prompt) {
            document.getElementById('messageInput').value = prompt;
            autoResizeTextarea();
        }

        async function showHistory() {
            showLoading();
            try {
                const response = await fetch(`${API_URL}/api/conversations`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const historyList = document.getElementById('historyList');
                    historyList.innerHTML = '';
                    
                    if (data.conversations.length === 0) {
                        historyList.innerHTML = `
                            <div style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                                <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 16px; opacity: 0.5;"></i>
                                <p style="font-size: 1.1rem;">
                                    ${currentLanguage === 'sw' ? 'Hakuna historia ya mazungumzo' : 'No chat history'}
                                </p>
                            </div>
                        `;
                    } else {
                        data.conversations.forEach(conv => {
                            const convElement = document.createElement('div');
                            convElement.className = 'history-item';
                            convElement.innerHTML = `
                                <div class="history-item-title">
                                    ${conv.title || (currentLanguage === 'sw' ? 'Mazungumzo' : 'Chat')}
                                </div>
                                <div class="history-item-date">
                                    ${new Date(conv.updatedAt).toLocaleDateString()} - 
                                    ${conv.messages?.length || 0} ${currentLanguage === 'sw' ? 'ujumbe' : 'messages'}
                                </div>
                            `;
                            convElement.onclick = () => loadConversation(conv.sessionId);
                            historyList.appendChild(convElement);
                        });
                    }
                    
                    document.getElementById('historyModal').classList.add('active');
                    closeMenu();
                } else {
                    showNotification(data.error || 'Hitilafu katika kupakia historia', 'error');
                }
            } catch (error) {
                showNotification('Hitilafu ya mtandao', 'error');
            } finally {
                hideLoading();
            }
        }

        function closeHistoryModal() {
            document.getElementById('historyModal').classList.remove('active');
        }

        async function loadConversation(sessionId) {
            showLoading();
            try {
                const response = await fetch(`${API_URL}/api/conversation/${sessionId}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    currentSessionId = sessionId;
                    
                    const container = document.getElementById('messagesContainer');
                    container.innerHTML = '';
                    
                    data.conversation.messages.forEach(msg => {
                        if (msg.role !== 'system') {
                            if (msg.isImage) {
                                addImageMessage(msg.imageUrl, msg.content);
                            } else {
                                addMessage(msg.role === 'user' ? 'outgoing' : 'incoming', msg.content);
                            }
                        }
                    });
                    
                    closeHistoryModal();
                    showNotification(
                        currentLanguage === 'sw' ? 'Mazungumzo yamepakuliwa' : 'Conversation loaded',
                        'success'
                    );
                } else {
                    showNotification(data.error || 'Hitilafu katika kupakia mazungumzo', 'error');
                }
            } catch (error) {
                showNotification('Hitilafu ya mtandao', 'error');
            } finally {
                hideLoading();
            }
        }

        function uploadFile() {
            document.getElementById('fileInput').click();
            closeMenu();
        }

        async function handleFileUpload() {
            const fileInput = document.getElementById('fileInput');
            const files = fileInput.files;
            
            if (!files.length) return;
            
            showLoading();
            
            for (let file of files) {
                const formData = new FormData();
                formData.append('file', file);
                
                try {
                    const response = await fetch(`${API_URL}/api/upload`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${authToken}`
                        },
                        body: formData
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        addMessage('outgoing', 
                            currentLanguage === 'sw' 
                                ? `Nimepakia faili: ${file.name}` 
                                : `Uploaded file: ${file.name}`
                        );
                        showNotification(
                            currentLanguage === 'sw' ? 'Faili imepakiwa kikamilifu' : 'File uploaded successfully',
                            'success'
                        );
                    } else {
                        showNotification(data.error || 'Hitilafu katika kupakia faili', 'error');
                    }
                } catch (error) {
                    showNotification('Hitilafu ya mtandao', 'error');
                }
            }
            
            fileInput.value = '';
            hideLoading();
        }

        function contactDeveloper() {
            window.open('https://wa.me/255789661031?text=Hello%20Developer%20Sila', '_blank');
            closeMenu();
        }

        function showSettings() {
            // Simple settings notification
            showNotification(
                currentLanguage === 'sw' 
                    ? 'Mipangilio haijaanzishwa bado. Itapatikana hivi karibuni!' 
                    : 'Settings not implemented yet. Coming soon!',
                'info'
            );
            closeMenu();
        }

        function toggleImageMode() {
            isImageMode = !isImageMode;
            const imageBtn = document.getElementById('imageModeBtn');
            const input = document.getElementById('messageInput');
            
            if (isImageMode) {
                imageBtn.classList.add('active');
                input.placeholder = currentLanguage === 'sw' 
                    ? 'Andika maelezo ya picha unayotaka...' 
                    : 'Describe the image you want...';
                showNotification(
                    currentLanguage === 'sw' ? 'Hali ya picha imewashwa' : 'Image mode enabled',
                    'info'
                );
            } else {
                imageBtn.classList.remove('active');
                input.placeholder = currentLanguage === 'sw' 
                    ? 'Andika ujumbe wako hapa...' 
                    : 'Type your message here...';
                showNotification(
                    currentLanguage === 'sw' ? 'Hali ya picha imezimwa' : 'Image mode disabled',
                    'info'
                );
            }
        }

        // Server health check
        async function checkServerHealth() {
            try {
                const response = await fetch(`${API_URL}/api/health`);
                if (response.ok) {
                    document.getElementById('chatStatus').textContent = 
                        currentLanguage === 'sw' ? 'Inatumika' : 'Online';
                }
            } catch (error) {
                document.getElementById('chatStatus').textContent = 
                    currentLanguage === 'sw' ? 'Haitumiki' : 'Offline';
            }
        }

        function loadLanguage() {
            const savedLang = localStorage.getItem('sila_language') || 'sw';
            changeLanguage(savedLang);
        }

        function logout() {
            if (confirm(
                currentLanguage === 'sw' 
                    ? 'Unahakika unataka kutoka?' 
                    : 'Are you sure you want to logout?'
            )) {
                localStorage.removeItem('sila_token');
                localStorage.removeItem('sila_user');
                currentUser = null;
                authToken = null;
                showAuthPage();
                showNotification(
                    currentLanguage === 'sw' ? 'Umetoka kikamilifu' : 'Logged out successfully',
                    'info'
                );
            }
        }
    </script>
</body>
</html>
